---
phase: 01-foundation-data-layer
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/db/schema.ts
  - src/lib/db.ts
  - drizzle.config.ts
  - .env.example
  - .env.local
  - tsconfig.json
autonomous: true
user_setup:
  - service: neon
    why: "Cloud Postgres database for persistent data"
    env_vars:
      - name: DATABASE_URL
        source: "Neon Console -> Project -> Connection Details -> Connection string (pooled)"
    dashboard_config:
      - task: "Create a Neon project (free tier, no credit card)"
        location: "https://console.neon.tech -> New Project"

must_haves:
  truths:
    - "Next.js project runs locally with `npm run dev` without errors"
    - "Drizzle schema defines weekends, work_items, done_criteria, and scorecard_ratings tables"
    - "drizzle-kit push successfully creates tables in Neon Postgres"
    - "Database connection works from a Server Component"
  artifacts:
    - path: "src/db/schema.ts"
      provides: "Four table definitions with relations"
      contains: "pgTable"
    - path: "src/lib/db.ts"
      provides: "Drizzle + Neon HTTP connection singleton"
      contains: "drizzle"
    - path: "drizzle.config.ts"
      provides: "Drizzle Kit configuration pointing to schema and Neon"
      contains: "defineConfig"
    - path: ".env.example"
      provides: "Template for required environment variables"
      contains: "DATABASE_URL"
  key_links:
    - from: "src/lib/db.ts"
      to: "src/db/schema.ts"
      via: "schema import for relational queries"
      pattern: "import.*schema"
    - from: "drizzle.config.ts"
      to: ".env.local"
      via: "dotenv loading DATABASE_URL"
      pattern: "process\\.env\\.DATABASE_URL"
---

<objective>
Scaffold the Next.js project with shadcn/ui, install Drizzle ORM + Neon packages, define the complete database schema for the AI Resolution Tracker, and push the schema to a Neon Postgres database.

Purpose: Establishes the entire project foundation — the directory structure, dependency tree, database schema, and cloud database connection that every subsequent plan builds upon.
Output: A running Next.js project with four database tables created in Neon Postgres.
</objective>

<execution_context>
@/Users/vladimirtsoy/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vladimirtsoy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-data-layer/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold Next.js project and install dependencies</name>
  <files>
    package.json
    tsconfig.json
    src/app/layout.tsx
    src/app/page.tsx
    src/app/globals.css
    components.json
    .gitignore
  </files>
  <action>
    Scaffold the project using `npx shadcn@latest create` in the current repository directory. The CLI is interactive — select these options:
    - Framework: Next.js
    - Style: Nova (compact, reduced padding)
    - Base color: Zinc (neutral, Apple-like)

    If `shadcn create` wants to create a new directory, run it with the project name matching the current directory, then move files up. If it detects an existing git repo and works in-place, proceed normally.

    After scaffolding, install the database layer and dev dependencies:
    ```bash
    npm install @neondatabase/serverless drizzle-orm
    npm install -D drizzle-kit tsx dotenv
    npm install zod
    ```

    Verify `.gitignore` includes `.env*.local` (shadcn create should handle this). If not, add it.

    Create `.env.example` with:
    ```
    # Get your connection string from Neon Console -> Project -> Connection Details
    DATABASE_URL=postgresql://user:password@host/database?sslmode=require
    ```

    Create `.env.local` with the actual Neon DATABASE_URL (user must have created a Neon project first — see user_setup in frontmatter). If DATABASE_URL is not available yet, create the file with a placeholder and note that user needs to set it.

    IMPORTANT: Do NOT add `"use client"` to any files. Phase 1 is 100% Server Components.
  </action>
  <verify>
    Run `npm run dev` — the Next.js dev server starts without errors.
    Run `npm ls @neondatabase/serverless drizzle-orm drizzle-kit` — all three packages are installed.
    Verify `.env.example` exists with DATABASE_URL placeholder.
    Verify `.gitignore` contains `.env*.local`.
  </verify>
  <done>
    Next.js dev server runs on localhost:3000 showing the default shadcn page. All database packages installed. Environment variable template committed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Define database schema and configure Drizzle</name>
  <files>
    src/db/schema.ts
    src/lib/db.ts
    drizzle.config.ts
  </files>
  <action>
    Create the Drizzle ORM schema with four tables, a category enum, and relations. Follow the exact schema from the research document (Pattern 2).

    **src/db/schema.ts** — Define these tables:

    1. `categoryEnum` — pgEnum with values: 'foundation', 'core_projects', 'automation', 'system_and_build', 'bonus'

    2. `weekends` table:
       - id: integer, primaryKey, generatedAlwaysAsIdentity
       - number: integer, notNull, unique
       - name: varchar(255), notNull
       - deliverable: text, notNull
       - whyItMatters: text('why_it_matters'), notNull
       - category: categoryEnum, notNull
       - isBonus: boolean, default false, notNull
       - notes: text (nullable — for user notes in later phases)
       - completedAt: timestamp with timezone (nullable)
       - createdAt: timestamp with timezone, defaultNow, notNull
       - updatedAt: timestamp with timezone, defaultNow, notNull

    3. `workItems` table:
       - id: integer, primaryKey, generatedAlwaysAsIdentity
       - weekendId: integer, notNull, references weekends.id with cascade delete
       - title: varchar(500), notNull
       - isAdvanced: boolean, default false, notNull
       - isCompleted: boolean, default false, notNull
       - sortOrder: integer, default 0, notNull
       - createdAt/updatedAt timestamps

    4. `doneCriteria` table:
       - id: integer, primaryKey, generatedAlwaysAsIdentity
       - weekendId: integer, notNull, references weekends.id with cascade delete
       - description: text, notNull
       - isMet: boolean, default false, notNull
       - sortOrder: integer, default 0, notNull
       - createdAt timestamp

    5. `scorecardRatings` table:
       - id: integer, primaryKey, generatedAlwaysAsIdentity
       - weekendId: integer, notNull, references weekends.id with cascade delete
       - criterion: varchar(255), notNull
       - rating: real (nullable)
       - comment: text (nullable)
       - createdAt/updatedAt timestamps

    Define Drizzle `relations` for all tables (weekends has many workItems, doneCriteria, scorecardRatings; each child belongs to one weekend).

    **src/lib/db.ts** — Create the database connection singleton using Pattern 1 from research:
    ```typescript
    import { neon } from '@neondatabase/serverless';
    import { drizzle } from 'drizzle-orm/neon-http';
    import * as schema from '@/db/schema';

    const sql = neon(process.env.DATABASE_URL!);
    export const db = drizzle({ client: sql, schema });
    ```

    **drizzle.config.ts** — Configure Drizzle Kit using Pattern 3 from research:
    ```typescript
    import { config } from 'dotenv';
    import { defineConfig } from 'drizzle-kit';

    config({ path: '.env.local' });

    export default defineConfig({
      schema: './src/db/schema.ts',
      out: './migrations',
      dialect: 'postgresql',
      dbCredentials: {
        url: process.env.DATABASE_URL!,
      },
    });
    ```

    Add npm scripts to package.json:
    ```json
    "db:push": "drizzle-kit push",
    "db:seed": "tsx src/db/seed.ts",
    "db:studio": "drizzle-kit studio"
    ```

    IMPORTANT: Use `integer().generatedAlwaysAsIdentity()` not deprecated `serial()`. Use `@neondatabase/serverless` HTTP driver not `pg` package.
  </action>
  <verify>
    Run `npx tsc --noEmit` — no TypeScript errors in schema.ts, db.ts, or drizzle.config.ts.
    Verify schema.ts exports: weekends, workItems, doneCriteria, scorecardRatings, categoryEnum, and all relations.
    Verify db.ts exports: db.
    Verify drizzle.config.ts points to correct schema path.
  </verify>
  <done>
    Schema defines 4 tables with proper types, relations, and identity columns. Database connection singleton uses Neon HTTP driver. Drizzle Kit configured and npm scripts added.
  </done>
</task>

<task type="auto">
  <name>Task 3: Push schema to Neon and verify tables exist</name>
  <files></files>
  <action>
    With DATABASE_URL set in `.env.local`, push the schema to the Neon database:

    ```bash
    npm run db:push
    ```

    This runs `drizzle-kit push` which applies the schema directly to the database (no migration files needed for initial development).

    After push, verify the tables were created by running a quick test query. Create a temporary test in `src/app/page.tsx` that queries the database:

    ```typescript
    import { db } from '@/lib/db';
    import { weekends } from '@/db/schema';

    export const dynamic = 'force-dynamic';

    export default async function HomePage() {
      const allWeekends = await db.select().from(weekends);
      return (
        <main>
          <h1>AI Resolution Tracker</h1>
          <p>Database connected. Weekends in DB: {allWeekends.length}</p>
        </main>
      );
    }
    ```

    Run `npm run dev` and verify localhost:3000 shows "Weekends in DB: 0" (empty but no errors).

    IMPORTANT: If `drizzle-kit push` fails with identity column issues on Neon, fall back to `drizzle-kit generate` followed by `drizzle-kit migrate` as noted in the research open questions.
  </action>
  <verify>
    `npm run db:push` completes without errors.
    `npm run dev` — visiting localhost:3000 shows "Weekends in DB: 0" with no console errors.
    The Neon Console shows the four tables (weekends, work_items, done_criteria, scorecard_ratings) created.
  </verify>
  <done>
    All four database tables exist in Neon Postgres. The Next.js app successfully connects to and queries the database from a Server Component. Schema push is complete.
  </done>
</task>

</tasks>

<verification>
1. `npm run dev` starts the dev server without errors
2. `npx tsc --noEmit` has no TypeScript errors
3. `npm run db:push` completes successfully
4. Visiting localhost:3000 shows a page that queries the database (returns 0 weekends, no errors)
5. `.env.example` exists with DATABASE_URL placeholder
6. `.gitignore` includes `.env*.local`
</verification>

<success_criteria>
- Next.js project scaffolded with shadcn/ui Nova style and all database packages installed
- Schema defines weekends, work_items, done_criteria, and scorecard_ratings tables with proper types and relations
- Tables exist in Neon Postgres (verified via drizzle-kit push)
- Server Component can query the database without errors
- Environment variable management is secure (.env.local gitignored, .env.example committed)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-data-layer/01-01-SUMMARY.md`
</output>
