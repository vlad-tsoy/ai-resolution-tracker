---
phase: 06-visualization-production-hardening
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/(dashboard)/error.tsx
  - src/app/(dashboard)/weekend/[id]/error.tsx
  - src/app/global-error.tsx
  - src/app/not-found.tsx
autonomous: true

must_haves:
  truths:
    - "A database connection failure on the overview page shows a friendly error screen with a retry button instead of a white screen"
    - "A database connection failure on the weekend detail page shows a friendly error screen with a retry button"
    - "A root layout error shows a minimal recovery page instead of crashing the entire app"
    - "Navigating to a non-existent URL shows a styled 404 page with a link back to the overview"
    - "Running npm run build produces zero errors and zero console warnings"
    - "The production build (next start) shows no console errors on the overview page or weekend detail page"
  artifacts:
    - path: "src/app/(dashboard)/error.tsx"
      provides: "Dashboard-level error boundary"
      contains: "use client"
    - path: "src/app/(dashboard)/weekend/[id]/error.tsx"
      provides: "Weekend detail error boundary"
      contains: "use client"
    - path: "src/app/global-error.tsx"
      provides: "Root-level error boundary catching layout errors"
      contains: "use client"
    - path: "src/app/not-found.tsx"
      provides: "Global 404 page"
      contains: "NotFound"
  key_links:
    - from: "src/app/(dashboard)/error.tsx"
      to: "Next.js error boundary system"
      via: "file convention auto-wrapping route in ErrorBoundary"
      pattern: "error.*reset"
    - from: "src/app/global-error.tsx"
      to: "Next.js root error boundary"
      via: "file convention replacing root layout on error"
      pattern: "<html>"
---

<objective>
Add production-grade error handling and performance verification to make the app resilient against database connectivity issues and other runtime errors.

Purpose: Fulfills DEPLOY-02 (no console errors, proper error handling) and DEPLOY-03 (page load under 3s). This is the production hardening that ensures the app is reliable when deployed.

Output: Error boundary files at dashboard and detail route levels, a global error boundary, a 404 page, and verified production build with no console errors.
</objective>

<execution_context>
@/Users/vladimirtsoy/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vladimirtsoy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-visualization-production-hardening/06-RESEARCH.md
@src/app/(dashboard)/page.tsx
@src/app/(dashboard)/weekend/[id]/page.tsx
@src/app/layout.tsx
@src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add error boundaries at dashboard and weekend detail route levels</name>
  <files>
    src/app/(dashboard)/error.tsx
    src/app/(dashboard)/weekend/[id]/error.tsx
  </files>
  <action>
1. Create `src/app/(dashboard)/error.tsx` -- dashboard-level error boundary:

   - Must be a Client Component ("use client")
   - Accept `error` (Error & { digest?: string }) and `reset` (() => void) props
   - Use `useEffect` to log error to console (keeping the error logged for debugging, but NOT showing raw errors to user)
   - Render a centered error UI matching the app's design system:
     - Container: `container mx-auto px-4 py-8`
     - Inner: `max-w-md mx-auto text-center space-y-4`
     - Heading: "Something went wrong" (text-xl font-semibold)
     - Description: "Unable to load your weekends. This is usually a temporary connection issue." (text-sm text-muted-foreground)
     - Retry button: calls `reset()`. Style as `inline-flex items-center justify-center rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90 transition-colors` (matching button styling from the design system)
   - This catches errors from the overview page Server Component (including database query failures)

2. Create `src/app/(dashboard)/weekend/[id]/error.tsx` -- weekend detail error boundary:

   - Same structure as above but with different messaging:
     - Heading: "Unable to load weekend"
     - Description: "There was a problem loading this weekend's details. Please try again."
     - Include both a retry button (calls reset()) AND a "Back to weekends" link (Next.js Link to "/")
   - Import `Link` from "next/link" for the back navigation
   - This catches errors from the detail page Server Component (including invalid ID database queries)
  </action>
  <verify>
    - Both error.tsx files exist and contain "use client" directive
    - `npx tsc --noEmit` passes
    - Both files export default functions accepting { error, reset } props
  </verify>
  <done>
    - Dashboard error boundary shows friendly error with retry for overview page failures
    - Weekend detail error boundary shows friendly error with retry and back link for detail page failures
    - Both use the app's design system (muted-foreground, primary button styling, container layout)
  </done>
</task>

<task type="auto">
  <name>Task 2: Add global error boundary, 404 page, and verify production build</name>
  <files>
    src/app/global-error.tsx
    src/app/not-found.tsx
  </files>
  <action>
1. Create `src/app/global-error.tsx` -- catches errors in the root layout:

   - Must be a Client Component ("use client")
   - MUST define its own `<html>` and `<body>` tags because it replaces the root layout when triggered
   - Accept `error` and `reset` props (same signature as route error boundaries)
   - Body styling: `className="min-h-screen flex items-center justify-center bg-white font-sans antialiased"` (use static colors since CSS variables from layout may not be available)
   - Minimal centered UI:
     - Heading: "Something went wrong" (text-xl font-semibold)
     - Description: "An unexpected error occurred. Please try refreshing the page." (text-sm text-zinc-500)
     - Retry button: calls reset(), styled with inline Tailwind (bg-zinc-900 text-white px-4 py-2 rounded-md text-sm)
   - Use inline/hardcoded zinc colors instead of CSS variable colors because the layout (which defines CSS variables) is the thing that errored

2. Create `src/app/not-found.tsx` -- global 404 page:

   - This is a Server Component (no "use client" needed)
   - Import `Link` from "next/link"
   - Render a centered 404 UI matching the app's design system:
     - Container: `container mx-auto px-4 py-8`
     - Inner: `max-w-md mx-auto text-center space-y-4`
     - Heading: "Page Not Found" (text-2xl font-bold)
     - Description: "The page you're looking for doesn't exist." (text-sm text-muted-foreground)
     - Link: "Back to weekends" pointing to "/" styled as `text-sm underline underline-offset-4 hover:text-primary`

3. Verify production build:

   - Run `npm run build` and confirm zero errors
   - Run `npm run start` briefly (or `npx next start`) and check that the overview page loads without console errors
   - If there are any TypeScript errors or build warnings, fix them before completing

4. Performance check:

   - The app already uses Server Components for data fetching (zero client JS overhead for data), loading.tsx skeletons, and the chart (from plan 01 if running in parallel) uses next/dynamic with ssr: false
   - The existing `force-dynamic` is appropriate for a single-user app that needs fresh data
   - Verify the build output shows reasonable bundle sizes (no unexpected large chunks in the initial page JS)
   - The <3s load target is met by: fast Neon HTTP queries (~50-200ms) + Server Component rendering + no unnecessary client JS + lazy-loaded chart bundle
  </action>
  <verify>
    - `src/app/global-error.tsx` exists, contains "use client", and defines `<html>` and `<body>` tags
    - `src/app/not-found.tsx` exists and exports a default component
    - `npm run build` passes with zero errors
    - The build output shows no "Error" lines
    - `npx tsc --noEmit` passes
  </verify>
  <done>
    - Global error boundary catches root layout errors and shows recovery UI
    - 404 page shows styled "Page Not Found" with link back to overview
    - Production build succeeds with zero errors
    - No console errors on production build pages
    - Bundle sizes are reasonable for <3s initial load target
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes with zero errors and zero warnings
2. `src/app/(dashboard)/error.tsx` exists and renders retry UI for dashboard errors
3. `src/app/(dashboard)/weekend/[id]/error.tsx` exists and renders retry UI with back link for detail errors
4. `src/app/global-error.tsx` exists with its own HTML/body tags for root-level errors
5. `src/app/not-found.tsx` renders a styled 404 page with navigation back to overview
6. No console errors visible when loading pages via `next start`
</verification>

<success_criteria>
- DEPLOY-02: No console errors in production, error boundaries catch database connectivity issues gracefully
- DEPLOY-03: Initial page load under 3s (Server Components + lazy-loaded chart + no unnecessary client JS)
- All error states show user-friendly messages with recovery options (retry button, back navigation)
- 404 page provides clear navigation back to the app
</success_criteria>

<output>
After completion, create `.planning/phases/06-visualization-production-hardening/06-02-SUMMARY.md`
</output>
