---
phase: 05-suggestion-engine-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/suggestions.ts
  - src/components/weekend/suggested-weekend-banner.tsx
  - src/app/(dashboard)/page.tsx
autonomous: true

must_haves:
  truths:
    - "Overview page shows a prominent 'Up Next' recommendation for which weekend to tackle next"
    - "Suggestion prioritizes in-progress weekends over not-started ones"
    - "Suggestion respects category dependency order (Foundation > Core Projects > Automation > System & Build)"
    - "When all weekends are completed, no suggestion is shown"
    - "User can still click any weekend freely (suggestion is non-blocking)"
  artifacts:
    - path: "src/lib/suggestions.ts"
      provides: "getSuggestedWeekend pure function"
      exports: ["getSuggestedWeekend"]
    - path: "src/components/weekend/suggested-weekend-banner.tsx"
      provides: "SuggestedWeekendBanner component"
      exports: ["SuggestedWeekendBanner"]
    - path: "src/app/(dashboard)/page.tsx"
      provides: "Overview page with suggestion banner integrated"
  key_links:
    - from: "src/app/(dashboard)/page.tsx"
      to: "src/lib/suggestions.ts"
      via: "getSuggestedWeekend called with weekends data"
      pattern: "getSuggestedWeekend\\(weekends\\)"
    - from: "src/app/(dashboard)/page.tsx"
      to: "src/components/weekend/suggested-weekend-banner.tsx"
      via: "SuggestedWeekendBanner rendered with suggested weekend props"
      pattern: "<SuggestedWeekendBanner"
---

<objective>
Build the suggestion engine that recommends which weekend to tackle next, and display it prominently on the overview page.

Purpose: This is the core intelligence of Phase 5 -- making the app proactively guide the user to their next action instead of requiring them to scan the list and decide.
Output: A pure function `getSuggestedWeekend` in `src/lib/suggestions.ts` and a `SuggestedWeekendBanner` component rendered on the overview page.
</objective>

<execution_context>
@/Users/vladimirtsoy/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vladimirtsoy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-suggestion-engine-polish/05-RESEARCH.md

@src/lib/queries.ts
@src/app/(dashboard)/page.tsx
@src/components/weekend/weekend-card.tsx
@src/components/weekend/weekend-grid.tsx
@src/components/weekend/progress-overview.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create suggestion engine pure function</name>
  <files>src/lib/suggestions.ts</files>
  <action>
Create `src/lib/suggestions.ts` with a `getSuggestedWeekend` pure function.

The function signature should accept the return type of `getWeekendsWithProgress()` (the `WeekendWithWorkItems[]` type). It returns a single weekend object or `null` if all are completed.

Algorithm:
1. Filter out bonus weekends (`isBonus === true`)
2. Derive status for each weekend from its work items (same `deriveStatus` logic as `weekend-card.tsx`: core items only, completed/in_progress/not_started)
3. If all weekends are completed, return `null`
4. Priority 1: Return the first in-progress weekend (lowest `number`)
5. Priority 2: Return the first not-started weekend respecting category dependency order: `foundation` -> `core_projects` -> `automation` -> `system_and_build`. Within each category, prefer lowest `number`.

Use the `WeekendWithWorkItems` type from `weekend-card.tsx` (import it). The category order constant should be defined in this file:
```typescript
const CATEGORY_ORDER = ["foundation", "core_projects", "automation", "system_and_build"] as const;
```

Export `getSuggestedWeekend` as a named export. Keep the function pure -- no database calls, no side effects.
  </action>
  <verify>Run `npx tsc --noEmit` to confirm no type errors. The file should have zero imports from database or server modules -- only from types.</verify>
  <done>getSuggestedWeekend function exists, is type-safe, handles all edge cases (all completed, in-progress priority, category order fallback, bonus exclusion).</done>
</task>

<task type="auto">
  <name>Task 2: Create suggestion banner and integrate into overview page</name>
  <files>src/components/weekend/suggested-weekend-banner.tsx, src/app/(dashboard)/page.tsx</files>
  <action>
**Create `src/components/weekend/suggested-weekend-banner.tsx`:**

A Server Component (no "use client" needed -- it just renders static markup with a Link). Props:
- `weekendId: number`
- `weekendNumber: number`
- `weekendName: string`

Render a Card that links to `/weekend/${weekendId}` with:
- A Sparkles icon (from lucide-react) on the left
- "Up Next" label in small caps, muted primary color
- "Weekend {number}: {name}" as the main text
- An ArrowRight icon on the right
- Subtle primary-tinted background: `border-primary/20 bg-primary/5 hover:bg-primary/10 transition-colors`
- Use shadcn Card and CardContent for structure
- Flex layout with items-center justify-between

Reference the research code example in `05-RESEARCH.md` for the exact pattern.

**Modify `src/app/(dashboard)/page.tsx`:**

1. Import `getSuggestedWeekend` from `@/lib/suggestions`
2. Import `SuggestedWeekendBanner` from `@/components/weekend/suggested-weekend-banner`
3. After fetching weekends, call `const suggested = getSuggestedWeekend(weekends)`
4. Render the banner between the ProgressOverview and WeekendGrid, only if `suggested` is not null:
```tsx
{suggested && (
  <SuggestedWeekendBanner
    weekendId={suggested.id}
    weekendNumber={suggested.number}
    weekendName={suggested.name}
  />
)}
```

The suggestion banner should NOT interfere with the user's ability to click any weekend card (SUGGEST-04). It is purely additive -- a recommendation, not a restriction.
  </action>
  <verify>Run `npm run build` to verify no build errors. Visit the overview page in the browser -- the "Up Next" banner should appear between progress bar and weekend grid, linking to the correct weekend.</verify>
  <done>Overview page shows "Up Next: Weekend N: Name" banner when there are incomplete weekends. No banner when all are completed. User can still freely navigate to any weekend.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no type errors
2. `npm run build` succeeds
3. Overview page renders suggestion banner pointing to correct weekend
4. Suggestion prioritizes in-progress weekends over not-started ones
5. Category order is respected for not-started weekend selection
6. All weekend cards remain clickable (non-blocking suggestion)
</verification>

<success_criteria>
- getSuggestedWeekend returns correct weekend based on completion state and category dependency order
- SuggestedWeekendBanner renders prominently on overview page with link to suggested weekend
- No suggestion shown when all weekends are completed
- User can navigate to any weekend regardless of suggestion
- Requirements SUGGEST-01, SUGGEST-02, SUGGEST-03, SUGGEST-04 are satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/05-suggestion-engine-polish/05-01-SUMMARY.md`
</output>
