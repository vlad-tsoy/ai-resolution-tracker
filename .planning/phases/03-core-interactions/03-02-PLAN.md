---
phase: 03-core-interactions
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/components/weekend/work-item-row.tsx
  - src/components/weekend/work-item-list.tsx
  - src/components/weekend/notes-editor.tsx
  - src/components/weekend/weekend-detail.tsx
autonomous: true

must_haves:
  truths:
    - "Clicking a work item checkbox immediately toggles its visual state"
    - "Checkbox state persists after page reload"
    - "All work items (core and advanced) have interactive checkboxes"
    - "Notes editor auto-saves after user stops typing for 1 second"
    - "Notes editor shows saving/saved status indicator"
    - "Live markdown preview appears below the textarea when notes have content"
    - "The overview page progress bar reflects work item toggles after navigation"
  artifacts:
    - path: "src/components/weekend/work-item-row.tsx"
      provides: "Single interactive checkbox row with optimistic toggle"
      exports: ["WorkItemRow"]
    - path: "src/components/weekend/work-item-list.tsx"
      provides: "Interactive work item list (replaces read-only version)"
      exports: ["WorkItemList"]
    - path: "src/components/weekend/notes-editor.tsx"
      provides: "Auto-saving notes textarea with markdown preview"
      exports: ["NotesEditor"]
    - path: "src/components/weekend/weekend-detail.tsx"
      provides: "Updated detail layout using interactive components"
      exports: ["WeekendDetail"]
  key_links:
    - from: "src/components/weekend/work-item-row.tsx"
      to: "src/lib/actions.ts"
      via: "Calls toggleWorkItem Server Action on checkbox change"
      pattern: "toggleWorkItem"
    - from: "src/components/weekend/notes-editor.tsx"
      to: "src/lib/actions.ts"
      via: "Calls saveNotes Server Action via debounced callback"
      pattern: "saveNotes"
    - from: "src/components/weekend/notes-editor.tsx"
      to: "src/lib/hooks/use-debounce.ts"
      via: "Uses useDebouncedCallback for auto-save delay"
      pattern: "useDebouncedCallback"
    - from: "src/components/weekend/weekend-detail.tsx"
      to: "src/components/weekend/work-item-list.tsx"
      via: "Renders WorkItemList for both core and advanced items"
      pattern: "WorkItemList"
    - from: "src/components/weekend/weekend-detail.tsx"
      to: "src/components/weekend/notes-editor.tsx"
      via: "Renders NotesEditor with weekendId and initialNotes props"
      pattern: "NotesEditor"
---

<objective>
Create interactive Client Components for work item checkboxes and notes editing, then update the detail page to use them instead of the read-only display.

Purpose: Transform the read-only detail view into the core CRUD loop -- users can check off work items (with optimistic UI) and write auto-saving notes (with markdown preview). This is the phase's primary user-facing deliverable.

Output: WorkItemRow (optimistic checkbox), WorkItemList (interactive list, replaces read-only), NotesEditor (auto-save textarea + markdown preview), updated WeekendDetail (wires everything together).
</objective>

<execution_context>
@/Users/vladimirtsoy/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vladimirtsoy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-core-interactions/03-01-SUMMARY.md
@src/db/schema.ts
@src/lib/actions.ts
@src/lib/hooks/use-debounce.ts
@src/components/weekend/weekend-detail.tsx
@src/components/weekend/work-item-list.tsx
@src/app/(dashboard)/weekend/[id]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create interactive work item components</name>
  <files>src/components/weekend/work-item-row.tsx, src/components/weekend/work-item-list.tsx</files>
  <action>
**Create `src/components/weekend/work-item-row.tsx`** as a Client Component (`'use client'`):

Props: `{ id: number; title: string; isCompleted: boolean; isAdvanced: boolean }`

Implementation:
- Use `useOptimistic(isCompleted)` for instant visual feedback
- Use `useTransition()` for `isPending` state
- `handleToggle` function: call `startTransition(async () => { setOptimisticCompleted(!optimisticCompleted); await toggleWorkItem(id); })`
- Render a `<label>` wrapping shadcn/ui `<Checkbox>` and the title text
- Checkbox uses `checked={optimisticCompleted}` and `onCheckedChange={handleToggle}`
- When `isPending`, apply `opacity-70` to the label for subtle loading feedback
- When `optimisticCompleted`, apply `line-through text-muted-foreground` to the title text
- When `isAdvanced` and NOT completed, apply `text-muted-foreground` to the title for visual de-emphasis
- Import `toggleWorkItem` from `@/lib/actions`
- Import `Checkbox` from `@/components/ui/checkbox`

**Replace `src/components/weekend/work-item-list.tsx`** (currently a read-only Server Component with icons):

Convert to a Client Component (`'use client'`). This is a breaking change from Phase 2 -- the file is completely rewritten.

Props: `{ items: Array<{ id: number; title: string; isCompleted: boolean; isAdvanced: boolean }> }`

Remove the `title` prop (the parent `WeekendDetail` will handle section titles).

Implementation:
- Import and render `WorkItemRow` for each item
- Wrap in `<div className="space-y-1">`
- Return null if items is empty

Remove all lucide-react icon imports (CheckCircle2, Circle) -- they are no longer needed since checkboxes replace icons.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify TypeScript compiles. Confirm both files have `'use client'` directive. Confirm `work-item-row.tsx` imports `useOptimistic`, `useTransition`, `Checkbox`, and `toggleWorkItem`.
  </verify>
  <done>WorkItemRow renders an interactive checkbox with optimistic toggle and pending state. WorkItemList renders a list of WorkItemRow components. Both are Client Components.</done>
</task>

<task type="auto">
  <name>Task 2: Create notes editor with auto-save and markdown preview</name>
  <files>src/components/weekend/notes-editor.tsx</files>
  <action>
**Create `src/components/weekend/notes-editor.tsx`** as a Client Component (`'use client'`):

Props: `{ weekendId: number; initialNotes: string | null }`

Implementation:
- `useState` for `value` (initialized from `initialNotes ?? ''`)
- `useState` for `saveStatus`: `'idle' | 'saving' | 'saved'`
- Create a memoized save callback with `useCallback` that:
  1. Sets `saveStatus` to `'saving'`
  2. Calls `await saveNotes(weekendId, text)`
  3. Sets `saveStatus` to `'saved'`
  4. Sets a 2-second timeout to reset `saveStatus` to `'idle'`
- Wrap the save callback in `useDebouncedCallback` with 1000ms delay
- `handleChange` function: update `value`, reset `saveStatus` to `'idle'`, call debounced save with new value
- Render:
  - A header row with "Notes" label (left) and save status indicator (right)
  - Status text: "Saving..." when saving, "Saved" when saved, empty when idle (all in `text-xs text-muted-foreground`)
  - shadcn/ui `<Textarea>` with `value`, `onChange={handleChange}`, placeholder "Reflections, links, learnings... (markdown supported)", `rows={6}`, `className="resize-y"`
  - Helper text: "Supports markdown formatting" in `text-xs text-muted-foreground`
  - **Live markdown preview**: When `value` is non-empty, render a `<div>` below with `react-markdown`:
    ```tsx
    import Markdown from 'react-markdown';
    ```
    Apply the Apple-minimalist design system styles via the `components` prop:
    - `h1`: `text-xl font-bold mt-4 mb-2`
    - `h2`: `text-lg font-semibold mt-3 mb-1`
    - `h3`: `text-base font-medium mt-2 mb-1`
    - `p`: `mt-2 leading-relaxed`
    - `ul`: `list-disc pl-5 mt-2 space-y-1`
    - `ol`: `list-decimal pl-5 mt-2 space-y-1`
    - `a`: `text-primary underline underline-offset-2` with `target="_blank"` and `rel="noopener noreferrer"`
    - `code`: `bg-muted px-1.5 py-0.5 rounded text-sm font-mono`
    - `blockquote`: `border-l-2 border-border pl-4 italic text-muted-foreground mt-2`
  - Preview container: `mt-4 p-4 rounded-lg bg-muted/50` with a "Preview" label in `text-xs font-medium text-muted-foreground uppercase tracking-wider mb-2`

Imports:
- `saveNotes` from `@/lib/actions`
- `useDebouncedCallback` from `@/lib/hooks/use-debounce`
- `Textarea` from `@/components/ui/textarea`
- `Markdown` (default) from `react-markdown`
- `useState`, `useCallback` from `react`

Do NOT use `@tailwindcss/typography` or `prose` classes. All markdown styling is via the `components` prop.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify TypeScript compiles. Confirm the file has `'use client'` directive. Confirm it imports `saveNotes`, `useDebouncedCallback`, `Textarea`, and `Markdown`.
  </verify>
  <done>NotesEditor renders a textarea that auto-saves via debounced Server Action (1s delay), shows saving/saved status, and displays a live markdown preview below the textarea using react-markdown with custom styled components.</done>
</task>

<task type="auto">
  <name>Task 3: Update WeekendDetail to use interactive components</name>
  <files>src/components/weekend/weekend-detail.tsx</files>
  <action>
**Rewrite `src/components/weekend/weekend-detail.tsx`** to integrate the new interactive components. This remains a Server Component (no `'use client'`) -- it passes data to Client Component children.

Changes from Phase 2 version:
1. **Remove** all lucide-react imports (CheckCircle2, Circle) -- no longer used for work items
2. **Keep** the `ArrowLeft` import from lucide-react for back navigation
3. **Update** the `WorkItemList` import -- it no longer accepts a `title` prop, so add section headings directly in WeekendDetail
4. **Add** import for `NotesEditor` from `@/components/weekend/notes-editor`
5. **Add** import for `Badge` from `@/components/ui/badge` (already imported in Phase 2 version)

Updated layout structure (keep the same overall structure but wire in interactivity):

```
article.max-w-2xl.mx-auto.space-y-8
  ├── Back navigation link (unchanged from Phase 2)
  ├── Header: Weekend number, name, deliverable (unchanged from Phase 2)
  ├── Core Work section:
  │   ├── h2 "Core Work" (moved from WorkItemList title prop to here)
  │   └── <WorkItemList items={coreItems} />  (now interactive checkboxes)
  ├── Advanced Modifiers section (if any):
  │   ├── h2 "Advanced Modifiers" + Badge "Optional"
  │   └── <WorkItemList items={advancedItems} />  (replace inline rendering with component)
  ├── Why It Matters section (unchanged from Phase 2)
  ├── Done When section (unchanged from Phase 2 -- keep CheckCircle2/Circle icons for done criteria, these remain read-only)
  └── <NotesEditor weekendId={weekend.id} initialNotes={weekend.notes} />
```

Key changes:
- Core work items: Replace `<WorkItemList items={coreItems} title="Core Work" />` with a section that has its own h2 heading and `<WorkItemList items={coreItems} />`
- Advanced modifiers: Replace the inline rendering (the `advancedItems.map` with icons) with `<WorkItemList items={advancedItems} />` inside the existing section wrapper. Keep the section's `text-muted-foreground` class and the "Optional" badge.
- **Keep** the `CheckCircle2` and `Circle` icon imports ONLY for the "Done When" section (done criteria remain read-only)
- Add `<NotesEditor>` as the last section

The `WeekendDetail` type stays the same: `NonNullable<Awaited<ReturnType<typeof getWeekendById>>>`.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify TypeScript compiles. Run `npm run build` to verify the full build succeeds (Server and Client Components properly separated). Visit `/weekend/1` in the browser to confirm the page renders with checkboxes and notes editor.
  </verify>
  <done>WeekendDetail now renders interactive checkboxes for all work items (core and advanced) via WorkItemList/WorkItemRow, keeps read-only icons for done criteria, and shows the NotesEditor at the bottom. The detail page is fully interactive.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. `npm run build` succeeds (no Server/Client Component boundary errors)
3. Visit `/weekend/1`:
   - Checkboxes appear for all work items (core and advanced)
   - Clicking a checkbox toggles it immediately (optimistic)
   - Refreshing the page preserves the toggle state
   - Notes textarea appears at the bottom
   - Typing in notes shows "Saving..." after 1 second, then "Saved"
   - Typing markdown (e.g., `**bold** text`) shows formatted preview below
4. Visit `/` (overview):
   - Progress bar and weekend card status reflect work item completions
   - Completing all core items for a weekend marks it as complete
</verification>

<success_criteria>
- DETAIL-02: Each work item has an interactive checkbox, checking persists across reloads
- DETAIL-03: Weekend auto-completes when all core items are checked (completedAt set/cleared by Server Action)
- NOTES-01: Free-text notes field per weekend (NotesEditor component)
- NOTES-02: Notes auto-save via debounced Server Action (no save button)
- NOTES-03: Notes support markdown formatting with live preview via react-markdown
- Overview page updates to reflect work item toggles (via revalidatePath)
</success_criteria>

<output>
After completion, create `.planning/phases/03-core-interactions/03-02-SUMMARY.md`
</output>
