---
phase: 02-weekend-overview
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/queries.ts
  - src/app/(dashboard)/page.tsx
  - src/app/(dashboard)/loading.tsx
  - src/components/weekend/weekend-card.tsx
  - src/components/weekend/weekend-grid.tsx
  - src/components/weekend/category-section.tsx
  - src/components/weekend/progress-overview.tsx
autonomous: true

must_haves:
  truths:
    - "The overview page displays all 10 weekends grouped into 4 categories (Foundation, Core Projects, Automation, System & Build)"
    - "The bonus weekend is displayed separately from the main 10 weekends"
    - "An overall progress bar shows completion percentage calculated from main weekends only (excludes bonus)"
    - "Each weekend card shows its name, deliverable one-liner, and visual completion status (completed, in-progress, not-started)"
    - "The overview page shows a skeleton loading state during data fetch"
    - "The grid layout is responsive (single column mobile, multi-column desktop)"
  artifacts:
    - path: "src/lib/queries.ts"
      provides: "Reusable database query functions for weekends"
      exports: ["getWeekendsWithProgress", "getWeekendById"]
    - path: "src/app/(dashboard)/page.tsx"
      provides: "Overview page (Server Component)"
      min_lines: 20
    - path: "src/app/(dashboard)/loading.tsx"
      provides: "Skeleton loading state for overview"
      min_lines: 10
    - path: "src/components/weekend/weekend-card.tsx"
      provides: "Card component for single weekend"
      exports: ["WeekendCard"]
    - path: "src/components/weekend/weekend-grid.tsx"
      provides: "Grid organizing weekends by category"
      exports: ["WeekendGrid"]
    - path: "src/components/weekend/category-section.tsx"
      provides: "Category group with heading and card grid"
      exports: ["CategorySection"]
    - path: "src/components/weekend/progress-overview.tsx"
      provides: "Overall progress bar with completion count"
      exports: ["ProgressOverview"]
  key_links:
    - from: "src/app/(dashboard)/page.tsx"
      to: "src/lib/queries.ts"
      via: "Server Component import"
      pattern: "getWeekendsWithProgress"
    - from: "src/app/(dashboard)/page.tsx"
      to: "src/components/weekend/weekend-grid.tsx"
      via: "Component import"
      pattern: "WeekendGrid"
    - from: "src/components/weekend/weekend-card.tsx"
      to: "/weekend/[id]"
      via: "Next.js Link"
      pattern: "Link.*href.*weekend"
    - from: "src/lib/queries.ts"
      to: "src/db/schema.ts"
      via: "Drizzle relational query"
      pattern: "db\\.query\\.weekends\\.findMany"
---

<objective>
Build the weekend overview page -- the main read path displaying all weekends grouped by category with progress tracking and responsive layout.

Purpose: Delivers requirements LIST-01 through LIST-05, UI-04 (responsive), and UI-05 (skeleton loading) for the overview page. This is the primary entry point users see.
Output: A working overview page at `/` showing all 10+1 weekends grouped by category, with an overall progress bar, status badges, and skeleton loading states. Also creates the shared query layer (`queries.ts`) used by both overview and detail pages.
</objective>

<execution_context>
@/Users/vladimirtsoy/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vladimirtsoy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-weekend-overview/02-RESEARCH.md

# Phase 1 outputs (schema, db connection, design system)
@src/db/schema.ts
@src/lib/db.ts
@src/app/globals.css
@src/app/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create query layer and overview page components</name>
  <files>
    src/lib/queries.ts
    src/components/weekend/progress-overview.tsx
    src/components/weekend/weekend-card.tsx
    src/components/weekend/category-section.tsx
    src/components/weekend/weekend-grid.tsx
  </files>
  <action>
Create the data access and presentational components. Reference the Phase 2 research file for exact code patterns.

**src/lib/queries.ts** -- Reusable query functions:
- `getWeekendsWithProgress()`: Fetches all weekends ordered by number, with work items (only `isCompleted` and `isAdvanced` columns for efficiency). Uses `db.query.weekends.findMany({ with: { workItems: { columns: { isCompleted: true, isAdvanced: true } } }, orderBy: (weekends, { asc }) => [asc(weekends.number)] })`.
- `getWeekendById(id: number)`: Fetches single weekend by ID with all work items (ordered by sortOrder) and done criteria (ordered by sortOrder). Uses `db.query.weekends.findFirst({ where: eq(weekends.id, id), with: { workItems: { orderBy: ... }, doneCriteria: { orderBy: ... } } })`.
- Both use the Drizzle relational query API (`db.query.*`), which requires schema to be passed to the drizzle client (already done in `src/lib/db.ts` from Phase 1).
- Import `db` from `@/lib/db`, `eq` from `drizzle-orm`, and `weekends` from `@/db/schema`.

**src/components/weekend/progress-overview.tsx** -- Overall progress bar:
- Props: `completed: number`, `total: number`
- Calculates percentage: `Math.round((completed / total) * 100)` with zero-division guard.
- Renders heading "Overall Progress", fraction text "{completed}/{total} weekends", percentage, and shadcn `<Progress>` component.
- `aria-label` on Progress for accessibility: "{completed} of {total} weekends completed".
- Use `h-2` height class on Progress for subtle Apple aesthetic.

**src/components/weekend/weekend-card.tsx** -- Individual weekend card:
- Props: a weekend object with `id`, `number`, `name`, `deliverable`, `workItems` (array with `isCompleted`, `isAdvanced`).
- Derives status from work items: `completed` if all core (non-advanced) items are done, `in_progress` if at least one core item is done, `not_started` otherwise.
- Status config object maps each status to: icon (CheckCircle2, Clock, Circle from lucide-react), label, Badge variant (default, secondary, outline), and card className for visual distinction.
  - completed: `opacity-80` card, default badge
  - in_progress: `ring-2 ring-primary/20` card, secondary badge
  - not_started: default card, outline badge
- Wraps entire card in `<Link href={/weekend/${weekend.id}}>`.
- Card shows: "Weekend {number}" label, status badge with icon, name as CardTitle, deliverable as CardDescription (with `line-clamp-2`), and "{completedCore}/{totalCore} core items" progress text.
- Uses shadcn Card, CardHeader, CardTitle, CardDescription, CardContent, Badge.
- Adds `transition-colors hover:bg-accent/50` on Card for hover feedback.

**src/components/weekend/category-section.tsx** -- Category group with header:
- Props: `title: string`, `weekends: WeekendWithWorkItems[]` (same type as weekend-card props).
- Renders category heading as `<h2>` with `text-lg font-semibold tracking-tight mb-4`.
- Renders responsive grid: `grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4`.
- Maps weekends to `<WeekendCard>` components.

**src/components/weekend/weekend-grid.tsx** -- Full grid with category grouping:
- Props: `weekends: WeekendWithWorkItems[]` (all weekends including bonus).
- Define category display order and labels:
  ```
  const CATEGORIES = [
    { key: 'foundation', label: 'Foundation' },
    { key: 'core_projects', label: 'Core Projects' },
    { key: 'automation', label: 'Automation' },
    { key: 'system_and_build', label: 'System & Build' },
  ] as const;
  ```
- Separate main weekends (non-bonus) from bonus weekend using `isBonus` field (or `number > 10`).
- For each category, filter weekends and render a `<CategorySection>`. Skip categories with no weekends.
- Render bonus weekend separately at bottom with a distinct section header "Bonus" and a single `<WeekendCard>`.
- Wrap everything in `<div className="space-y-10">`.

**Type inference:** Do NOT create a separate types file. Use Drizzle's inferred types via `Awaited<ReturnType<typeof getWeekendsWithProgress>>[number]` or define local type aliases in the component files. This avoids a separate types layer that can drift from the schema.
  </action>
  <verify>
Run `npx tsc --noEmit` and confirm no TypeScript errors in the new files. Check that all imports resolve correctly.
  </verify>
  <done>
Five files created. queries.ts exports two functions using Drizzle relational queries. Four presentational components compose into a category-grouped weekend grid with progress tracking and status badges.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build overview page and skeleton loading</name>
  <files>
    src/app/(dashboard)/page.tsx
    src/app/(dashboard)/loading.tsx
  </files>
  <action>
Create the overview page and its skeleton loading state. Reference the Phase 2 research for exact patterns.

**src/app/(dashboard)/page.tsx** -- Overview page (async Server Component):
- This is an `async` Server Component (no "use client").
- Call `getWeekendsWithProgress()` to fetch all weekends.
- Separate main weekends from bonus: `weekends.filter(w => !w.isBonus)` for main, `weekends.find(w => w.isBonus)` for bonus.
- Calculate completed count from main weekends: count weekends where ALL core (non-advanced) work items have `isCompleted === true`. A weekend with zero core items is NOT counted as completed.
- Pass `completed` and `total={10}` to `<ProgressOverview>`.
- Pass all weekends (main + bonus) to `<WeekendGrid>`.
- Layout: `<main className="container mx-auto px-4 py-8 space-y-8">` wrapping a page title, progress overview, and weekend grid.
- Page title: "AI Resolution Tracker" as `<h1 className="text-3xl font-bold tracking-tight">`.

NOTE: The `(dashboard)` route group is a parenthesized folder -- it does NOT add a URL segment. The page is accessible at `/`.

If Phase 1 created a `src/app/page.tsx`, this plan replaces it by moving the main page into the `(dashboard)` route group. If there's an existing `src/app/page.tsx`, keep it as a redirect or remove it -- the `(dashboard)/page.tsx` becomes the new root page. Check if Phase 1's layout.tsx already wraps children; if so, `(dashboard)` does not need its own layout.

**src/app/(dashboard)/loading.tsx** -- Skeleton loading state:
- Uses shadcn `<Skeleton>` and `<Card>` components.
- Must MATCH the real page layout to avoid layout shift:
  - Progress bar skeleton: `<Skeleton className="h-4 w-full max-w-md" />`
  - 4 category section skeletons, each with: a heading skeleton (`h-6 w-32`) and a responsive grid (`grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4`) containing 2-3 card skeletons.
  - Each card skeleton: Card with Skeleton lines for header and content.
- Use the same container/spacing classes as the real page: `container mx-auto px-4 py-8 space-y-8`.
  </action>
  <verify>
Run the dev server (`npm run dev`) and navigate to `/`. Confirm:
1. The page loads without console errors.
2. All 10 weekends appear grouped by their categories.
3. The bonus weekend appears in a separate section.
4. The progress bar shows 0/10 (since no items are completed yet).
5. Each card shows weekend name, deliverable, and "Not Started" badge.
6. Clicking a card navigates to `/weekend/{id}` (will 404 until Plan 02 -- that's expected).
7. During navigation, the skeleton loading state appears briefly (check by throttling network in DevTools).
  </verify>
  <done>
The overview page at `/` renders all 10+1 weekends grouped by category with progress tracking, status badges, and skeleton loading. Cards link to detail pages. Layout is responsive across breakpoints.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `npm run build` completes without build errors
3. Overview page at `/` displays all 11 weekends (10 main + 1 bonus)
4. Weekends are grouped under 4 category headings in correct order: Foundation, Core Projects, Automation, System & Build
5. Bonus weekend appears in separate section below main categories
6. Progress bar shows "0/10 weekends" with 0% (no work items completed)
7. Each card shows weekend number, name, deliverable, and "Not Started" status badge
8. Cards have hover state (bg-accent/50 transition)
9. Grid is responsive: 1 column on mobile, 2 on sm, 3 on lg
10. Loading skeleton appears during page navigation (visible with network throttling)
</verification>

<success_criteria>
The overview page is the functional entry point of the app. All 10 weekends are visible, categorized, and linked. The progress bar reflects completion state. The page renders entirely on the server (no "use client" directives on page or component files). Skeleton loading states prevent blank screens during navigation.
</success_criteria>

<output>
After completion, create `.planning/phases/02-weekend-overview/02-01-SUMMARY.md`
</output>
